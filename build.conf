#!/usr/bin/env bash
# build.conf — Central configuration for Proxmox-ISO-t2
# Sourced by prepare.sh, build.sh, reset.sh

# ── Proxmox VE source ISO ────────────────────────────────────────────────────
PVE_VERSION="8.4"
PVE_ISO_BUILD="1"
PVE_ISO_NAME="proxmox-ve_${PVE_VERSION}-${PVE_ISO_BUILD}.iso"
PVE_ISO_URL="https://enterprise.proxmox.com/iso/${PVE_ISO_NAME}"

# ── T2 kernel (pve-edge-kernel-t2 by Aditya Garg) ───────────────────────────
# https://github.com/AdityaGarg8/pve-edge-kernel-t2/releases
T2_KERNEL_VERSION="6.17.13-1-t2-1"
# Base version strips the trailing -t2-N suffix (used in asset filenames)
T2_KERNEL_BASE_VERSION="${T2_KERNEL_VERSION%-t2-*}"
T2_KERNEL_DEB="proxmox-kernel-${T2_KERNEL_BASE_VERSION}-pve-t2_${T2_KERNEL_BASE_VERSION}_amd64.deb"
T2_HEADERS_DEB="proxmox-headers-${T2_KERNEL_BASE_VERSION}-pve-t2_${T2_KERNEL_BASE_VERSION}_amd64.deb"
T2_KERNEL_RELEASE_URL="https://github.com/AdityaGarg8/pve-edge-kernel-t2/releases/download/v${T2_KERNEL_VERSION}"

# ── t2linux APT repository (apple-t2-audio-config, apple-firmware-script) ───
T2_APT_REPO_KEYURL="https://adityagarg8.github.io/t2-ubuntu-repo/KEY.gpg"
T2_APT_REPO_LIST="deb [signed-by=/etc/apt/trusted.gpg.d/t2-ubuntu-repo.gpg] https://github.com/AdityaGarg8/t2-ubuntu-repo/releases/download/bookworm ./"

# ── Build directories ────────────────────────────────────────────────────────
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
WORK_DIR="${SCRIPT_DIR}/work"
OUT_DIR="${SCRIPT_DIR}/out"
ISO_EXTRACT_DIR="${WORK_DIR}/iso-extract"
PVE_BASE_EXTRACT="${WORK_DIR}/pve-base-root"
PACKAGES_DIR="${SCRIPT_DIR}/packages"

# ── Output ISO ───────────────────────────────────────────────────────────────
ISO_OUT="${OUT_DIR}/proxmox-ve-t2_${PVE_VERSION}-${PVE_ISO_BUILD}.iso"
ISO_LABEL="PVE"
